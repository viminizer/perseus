# Phase 6.1: Layout Overhaul — Plan 01

## Objective

Transform the layout from vertical stacked panels to a Postman-style layout with:
1. Empty sidebar placeholder on the left
2. Horizontal request input row: `[Method] [URL] [Send]`
3. Method selector popup with colored methods and j/k navigation

## Context

**Current state:**
- `AppLayout` splits screen into request (45%) | response (55%) horizontally
- `RequestLayout` stacks Method, URL, Headers, Body vertically
- Method selection via h/l cycling inline, no popup

**Target state:**
- New layout: Sidebar (20%) | Main area (80%)
- Main area: Request input row at top, Headers/Body below, Response on right
- Method popup modal with vim navigation

**Files to modify:**
- `src/ui/layout.rs` — restructure layout calculations
- `src/ui/mod.rs` — add method popup rendering
- `src/app.rs` — add popup state and keyboard handling

## Tasks

### Task 1: Add sidebar to main layout
**File:** `src/ui/layout.rs`

Update `AppLayout` to include a sidebar area:
- Add `sidebar_area: Rect` field
- Split horizontally: sidebar (fixed 20 chars or 15%) | main content
- Main content still splits into request_area | response_area
- Keep status_bar at bottom

### Task 2: Create horizontal request input row layout
**File:** `src/ui/layout.rs`

Create new `RequestInputLayout` struct:
- Method area: fixed width (8 chars — fits "DELETE" + padding)
- URL area: `Min(1)` to fill remaining space
- Send button area: fixed width (8 chars — fits "[ Send ]")

Update `RequestLayout`:
- First row uses `RequestInputLayout` for method/url/send
- Remaining space for headers and body (stacked vertically)

### Task 3: Add popup state to App
**File:** `src/app.rs`

Add method selector popup state:
- `show_method_popup: bool` field in `App`
- `method_popup_index: usize` field for selected method
- Helper `all_methods() -> [HttpMethod; 5]` for iteration
- Initialize popup_index based on current method when opening

### Task 4: Handle popup keyboard navigation
**File:** `src/app.rs`

Update `handle_normal_mode`:
- When on Method field + Enter pressed → open popup
- When popup open:
  - j/Down → next method (wrap)
  - k/Up → prev method (wrap)
  - Enter → select method, close popup
  - Esc → close popup without change

### Task 5: Render empty sidebar
**File:** `src/ui/mod.rs`

Add `render_sidebar` function:
- Render block with "Collections" title
- Empty content (placeholder text: "No collections yet")
- Border color: dim when not focused

Update `render` to call `render_sidebar`.

### Task 6: Render horizontal request input row
**File:** `src/ui/mod.rs`

Refactor `render_request_panel`:
- Render method box (compact, colored by method)
- Render URL input (expands)
- Render Send button (styled as button)
- Headers and Body render below as before

Add `method_color(HttpMethod) -> Color` helper:
- GET → Green
- POST → Blue
- PUT → Yellow
- PATCH → Magenta
- DELETE → Red

### Task 7: Render method selector popup
**File:** `src/ui/mod.rs`

Add `render_method_popup` function:
- Centered popup, small size (width ~15, height ~7)
- List all methods with their colors
- Highlight selected method with inverse colors
- Render over other content using `Clear`

Update `render` to call popup when `app.show_method_popup`.

### Task 8: Update focus handling for new layout
**File:** `src/app.rs`

Add `Sidebar` variant to `Panel` enum (for future use).

Keep current focus logic but ensure:
- Tab cycles: Request → Response → Request (Sidebar skipped for now — empty)
- Request fields: Method → Url → Headers → Body

## Verification

After each task, run:
```bash
cargo build
```

After all tasks, verify visually:
```bash
cargo run
```

Check:
- [ ] Sidebar visible on left (empty placeholder)
- [ ] Method/URL/Send in horizontal row
- [ ] Enter on Method opens popup
- [ ] j/k navigates popup, Enter selects
- [ ] Methods display in their distinct colors
- [ ] All existing functionality preserved

## Success Criteria

- Layout matches Postman-style: sidebar | main (request row + editors | response)
- Method popup appears/navigates/selects correctly
- No regressions in request sending, response display, help overlay
- Clean compile with no warnings

## Output

On completion, update:
- `.planning/phases/06.1-layout-overhaul/06.1-01-SUMMARY.md`
- `.planning/STATE.md` — mark phase 6.1 complete
